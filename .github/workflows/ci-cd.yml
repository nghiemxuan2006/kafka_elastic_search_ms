# name: Deploy Backend to Server

# # Triggers the workflow on push to the main branch
# on:
#   push:
#     branches:
#       - kafka

# jobs:
#   build: # Name of the job
#     runs-on: [self-hosted, Linux, X64] # Operating system to run the job on

#     steps: # Steps to run in the job
#       - name: Checkout repository # Name of the step
#         uses: actions/checkout@v2 # Use the checkout action
#         with:
#           fetch-depth: 0

#       - name: Run docker
#         run: |
#           echo "Pulled latest changes from the kafka branch" && \
#           sudo docker-compose up --build -d
#         # run: |
#         #   echo "Pulled latest changes from the kafka branch"
  

name: Deploy Backend to Server

on:
  push:
    branches:
      - kafka

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Deploy to Server via SSH
      uses: webfactory/ssh-agent@v0.5.3
      with:
        ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
    # - name: SSH into server and deploy
    #   run: |
    #       ssh -o StrictHostKeyChecking=no nghiemxuan@${{ secrets.SERVER_HOST }}
    #       pwd
    #       cd ~/kafka_elastic_search_ms
    #       git pull origin kafka
    - name: Set up SSH
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SERVER_HOST }}         # Add this secret in GitHub with your server IP
        username: nghiemxuan     # Add this secret with your SSH username
        key: ${{ secrets.SSH_PRIVATE_KEY }}   # The SSH private key secret
        script: |
          cd ~/kafka_elastic_search_ms
          git pull origin kafka

          echo "Pulled latest changes from the kafka branch" && \
          sudo docker-compose up --build -d
      # run: |
      #   echo "Pulled latest changes from the kafka branch"